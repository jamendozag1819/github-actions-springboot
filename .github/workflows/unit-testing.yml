- name: Verificar cobertura con JaCoCo
  run: "echo \"Verificando cobertura de código...\"\nJACOCO_FILE=target/site/jacoco/jacoco.xml\n\nif [ ! -f \"$JACOCO_FILE\" ]; then\n  echo \"❌ No se encontró el archivo de cobertura: $JACOCO_FILE\"\n  exit 1\nfi\n\nCOVERED=$(xmllint --xpath \"string(//counter[@type='INSTRUCTION']/@covered)\" $JACOCO_FILE)\nMISSED=$(xmllint --xpath \"string(//counter[@type='INSTRUCTION']/@missed)\" $JACOCO_FILE)\n\nTOTAL=$((COVERED + MISSED))\nif [ \"$TOTAL\" -eq 0 ]; then\n  COVERAGE=0\nelse\n  COVERAGE=$(awk \"BEGIN { printf \\\"%.2f\\\", ($COVERED / ($COVERED + $MISSED)) * 100 }\")\nfi\n\necho \"✅ Cobertura total: $COVERAGE%\"\necho \"\U0001F4CA Umbral requerido: ${{ inputs.coverage-threshold }}%\"\n\nif (( $(echo \"$COVERAGE < ${{ inputs.coverage-threshold }}\" | bc -l) )); then\n  echo \"⚠️ La cobertura está por debajo del umbral requerido.\"\n  if [ \"${{ inputs.fail-on-coverage }}\" = \"true\" ]; then\n    echo \"❌ Fallando el job debido a cobertura insuficiente.\"\n    exit 1\n  else\n    echo \"\U0001F514 Advertencia: cobertura baja, pero no se fallará el job.\"\n  fi\nelse\n  echo \"✅ Cobertura suficiente. Continuando con el pipeline.\"\nfi\n"
