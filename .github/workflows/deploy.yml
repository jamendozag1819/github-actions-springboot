
name: CI/CD Pipeline

#Se declaran los eventos y las ramas que disparan el workflow
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      override_gates:
        description: 'Anulaci√≥n de la puerta de despliegue seguro (solo para despliegue de emergencia)'
        required: false
        default: 'false'
        type: choice
        options:
          - 'false'
          - 'true'
  
env:
    JAVA_VERSION: '17'
    MAVEN_VERSION: '3.8.6'
    DOCKER_BUILDKIT: 1
#    PDP_URL: http://localhost:7766
#    REGISTRY_DOMAIN: "pocpipeline.jfrog.io"
#    REGISTRY_REPOSITORY: "dev-pipeline-docker-docker"

jobs:
  build:
    name: Build Application
    uses: ./.github/workflows/build-application.yml
    with:
      java-version: '17'
      maven-version: '3.8.6'

  unit-tests:
      name: Unit Tests & Coverage
      needs: build
      uses: ./.github/workflows/unit-testing.yml
      with:
        java-version: '17'
        coverage-threshold: 50
        fail-on-coverage: false
        maven-version: '3.8.6'